<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ğŸ¥§tg_bot&gt;&gt;tx_bot">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“">
<meta property="og:url" content="https://www.gubaiovo.com/posts/a6f3e185.html">
<meta property="og:site_name" content="GuBai">
<meta property="og:description" content="ğŸ¥§tg_bot&gt;&gt;tx_bot">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/BotFather.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/start.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/createbot.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/startbot.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/invitebot.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/getid.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/testmessage.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/test.png">
<meta property="og:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/final.png">
<meta property="article:published_time" content="2025-02-19T12:48:24.000Z">
<meta property="article:modified_time" content="2026-02-15T09:20:27.317Z">
<meta property="article:author" content="gubai">
<meta property="article:tag" content="Dev">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/BotFather.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">æ–‡ç« </a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/gubaiovo">é¡¹ç›®</a></li><!--
     --><!--
       --><li><a href="/search/">æœç´¢</a></li><!--
     --><!--
       --><li><a href="/categories/">åˆ†ç±»</a></li><!--
     --><!--
       --><li><a href="/links/">é“¾æ¥</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡" href="/posts/9b196f56.html"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/posts/693deb78.html"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.gubaiovo.com/posts/a6f3e185.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.gubaiovo.com/posts/a6f3e185.html&text=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.gubaiovo.com/posts/a6f3e185.html&is_video=false&description=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“&body=Check out this article: https://www.gubaiovo.com/posts/a6f3e185.html"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.gubaiovo.com/posts/a6f3e185.html&name=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.gubaiovo.com/posts/a6f3e185.html&t=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B3%E8%AF%B7tg-bot"><span class="toc-number">1.1.</span> <span class="toc-text">ç”³è¯·tg bot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99shell"><span class="toc-number">1.2.</span> <span class="toc-text">ç¼–å†™shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%B0%83%E7%94%A8%E6%8E%A8%E9%80%81"><span class="toc-number">1.3.</span> <span class="toc-text">è‡ªåŠ¨è°ƒç”¨æ¨é€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ALL-CODE"><span class="toc-number">1.4.</span> <span class="toc-text">ALL CODE</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">gubai</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-02-19T12:48:24.000Z" class="dt-published" itemprop="datePublished">2025-02-19</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Dev/">Dev</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Dev/" rel="tag">Dev</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1>Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“</h1>
<blockquote>
<p>çªå‘å¥‡æƒ³ï¼Œhexoèƒ½ä¸èƒ½å®ç°è‡ªåŠ¨æ¨é€åŠŸèƒ½ã€‚é€‰æ‹©tgä¸»è¦æ˜¯å› ä¸ºtgçš„botå¾ˆå¼ºå¤§ï¼ˆå¯¹æ¯”txçš„å°è‚šé¸¡è‚ ï¼Œå·²ç»éå¸¸ä¸é”™äº†ï¼‰ã€‚ç¿»äº†ä¸€åœˆï¼Œå‘ç°åŸºæœ¬éƒ½æ˜¯åŸºäºgithub actionå®ç°çš„æ¨é€ã€‚å¯¹github actionå®åœ¨ä¸ç†Ÿæ‚‰ï¼Œå¤ç°ä¹Ÿå¤±è´¥äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºéœ€è¦å®Œå…¨é€šè¿‡github actionæ„å»ºå¹¶æ›´æ–°ï¼ˆï¼Ÿã€‚åªèƒ½æ›²çº¿æ•‘å›½ï¼Œç»“åˆgithub actionçš„ä¾‹å­å’Œtg api docï¼Œç”¨shellè„šæœ¬å®Œæˆè‡ªåŠ¨æ¨é€ã€‚</p>
</blockquote>
<p>æ ¸å¿ƒæµç¨‹ä¸ºï¼š<code>ç”³è¯·bot</code> â†’ <code>ç¼–å†™shell(linux)</code> â†’ <code>æ·»åŠ è„šæœ¬å¯åŠ¨</code></p>
<h2 id="ç”³è¯·tg-bot">ç”³è¯·tg bot</h2>
<p>é¦–å…ˆæ·»åŠ ä¸€ä¸ªå« <a target="_blank" rel="noopener" href="https://t.me/BotFather">BotFather</a> çš„æœºå™¨äººï¼Œç”¨æ¥ç”³è¯·bot</p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/BotFather.png" alt="image-20250218230347122"></p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/start.png" alt="image-20250218230542295"></p>
<p>æ¥ä¸‹æ¥ä¼šä¾æ¬¡è¦æ±‚å¡«å†™ <code>name</code> å’Œ <code>username</code></p>
<p><code>name</code> å’Œ <code>username</code> æ˜¯ä¸åŒçš„ã€‚<code>name</code> æŒ‡botæ˜¾ç¤ºçš„åå­—ï¼Œ<code>username</code> æŒ‡botå®é™…çš„åå­—(ç”¨æ¥æœç´¢çš„åå­—)</p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/createbot.png" alt="image-20250218230847351"></p>
<p>è¿™é‡Œ <code>name</code> ä¸º <code>gubai's bot</code>ï¼Œ<code>username</code> ä¸º <code>gubai_blog_bot</code></p>
<p>ç”³è¯·æˆåŠŸåçš„æ¶ˆæ¯ä¸­ï¼Œ <code>t.me/gubai_blog_bot</code> å¯ä»¥è®¿é—®botï¼Œä¸‹é¢æä¾›çš„tokenæ˜¯è¿™ä¸ªbotçš„å”¯ä¸€æ ‡è¯†ï¼Œéå¸¸é‡è¦ï¼Œä¸èƒ½æ³„éœ²</p>
<p>ä½†æ˜¯è®¿é—®botå‘ç°æ²¡æœ‰ä»»ä½•å“åº”ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ç¼–å†™é€»è¾‘</p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/startbot.png" alt="image-20250218231329072"></p>
<p>å°†botæ‹‰å…¥å¸Œæœ›æ¨é€æ–‡ç« çš„é¢‘é“/ç¾¤ç»„ï¼ˆåˆ«å¿˜è®°ç»™æƒé™ï¼‰</p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/invitebot.png" alt="image-20250219191834013"></p>
<p>tgä¸­æ¯ä¸ªèŠå¤©çª—å£æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ <code>ChatID</code></p>
<p>é‚€è¯·bot <a href="">@get_id_bot</a> è¿›å…¥é¢‘é“ï¼Œå‘é€å‘½ä»¤ <code>/my_id@get_id_bot</code></p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/getid.png" alt="image-20250219192723201"></p>
<p>å¾—åˆ°ChatID <code>-1002492764196</code></p>
<p>ä¸ºäº†è§„èŒƒé¢‘é“ï¼Œå¯ä»¥å°†æ‰€æœ‰å’Œbotäº¤äº’å†…å®¹éƒ½åˆ é™¤ã€‚è‡³äºç”¨æ¥è·å¾—idçš„botï¼Œå¯ä»¥è¸¢æ‰ï¼Œä¹Ÿå¯ä»¥ç¦è¨€</p>
<h2 id="ç¼–å†™shell">ç¼–å†™shell</h2>
<p>åœ¨ä»»æ„ç›®å½•çœ‹ç€é¡ºçœ¼çš„ä½ç½®åˆ›å»ºä¸€ä¸ª.shæ–‡ä»¶ï¼Œåå­—éšæ„ï¼Œè¿™é‡Œæ˜¯ <code>TG_push.sh</code>ï¼Œç»™æ‰§è¡Œæƒé™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x TG_push.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxx # å¡«å…¥è‡ªå·±çš„bot token</span><br><span class="line">ChatID=xxx	# å¡«å…¥id</span><br></pre></td></tr></table></figure>
<p>æ¨é€çš„æ€è·¯æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œåˆ—å‡ºæˆ‘çš„ä¸¤ç§æ€è·¯ã€‚</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è·å–æœ€æ–°ç¼–è¾‘çš„æ–‡ä»¶ï¼Œæå–titleå’Œaddrlinkï¼Œç»„æˆmessageå‘é€</p>
</li>
<li class="lvl-2">
<p>éå†æ‰€æœ‰ <code>./source/_posts</code>ä¸‹çš„æ–‡ä»¶ï¼Œåˆ©ç”¨<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/front-matter">hexo Front-matter</a>ï¼Œè‡ªå®šä¹‰æ–°çš„é…ç½®é¡¹ <code>push</code> (å½“ç„¶ï¼Œä¹Ÿå¯ä»¥èµ·å…¶ä»–key)ï¼Œå½“è¯¥é¡¹ä¸º <code>true</code> (å½“ç„¶ï¼Œå¯ä»¥æ”¹ä¸ºå…¶ä»–value) æ—¶ï¼Œè·å–titleå’Œaddrlink</p>
</li>
</ul>
<p>ç¬¬äºŒç§æ˜¯åæ¥æƒ³èµ·Front-matterä¸è¢«æ¸²æŸ“åå®è·µçš„ï¼Œæ•ˆæœå¾ˆå¥½ï¼Œæ¯”ç¬¬ä¸€ç§æ–¹å¼ç¨³å®šï¼Œè€Œä¸”æ”¯æŒå¤šæ–‡ç« è‡ªé€‰æ¨é€ã€‚</p>
<p>ä¸‹é¢è¯¦ç»†ä»‹ç»ç¬¬äºŒç§æ–¹å¼çš„å®ç°ï¼Œç¬¬ä¸€ç§æ–¹å¼çš„ä»£ç ä¼šæ”¾åˆ°æœ€åã€‚</p>
<p>è®¾æƒ³æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">ä¸»é¡µï¼šxxxxx</span><br><span class="line">åšå®¢ï¼šxxxxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">æ¨é€æ—¶é—´ï¼šxxxx</span><br><span class="line">â€”â€”â€”â€”updateâ€”â€”â€”â€”</span><br><span class="line">æ ‡é¢˜ï¼šxxx</span><br><span class="line">é“¾æ¥ï¼šxxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">æ ‡é¢˜ï¼šxxx</span><br><span class="line">é“¾æ¥ï¼šxxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå…ˆå®Œæˆ <code>update</code> ä»¥ä¸Šçš„éƒ¨åˆ†ï¼Œç»§ç»­ç¼–å†™shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;) #è·å–å½“å‰æ—¶é—´</span><br><span class="line">commitMsg=&quot;</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">main: https://www.gubaiovo.com</span><br><span class="line">blog: https://blog.gubaiovo.com</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">Time: $&#123;currentTime&#125;</span><br><span class="line"></span><br><span class="line">â€”â€”â€”â€”â€”â€”UPDATEâ€”â€”â€”â€”â€”â€”</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦æ³¨æ„ï¼Œæ¢è¡Œä¸è¦ç›´æ¥å†™ <code>\n</code> è¿›è¡Œæ¢è¡Œï¼Œä¼šè¢«å„ç§ç¥ç§˜è½¬ä¹‰æ— æ³•å˜æˆæ¢è¡Œç¬¦ã€‚ä½†æ˜¯åƒä¸Šé¢åœ¨shellä¸­ç¼–å†™æ—¶ç›´æ¥æ¢è¡Œæ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”æœ€ç»ˆå‘ˆç°çš„æ•ˆæœä¹Ÿæ˜¯æ¢è¡Œã€‚</p>
<p>è¿™é‡Œå¯ä»¥å…ˆå‘é€ä¸€æ¬¡è¿›è¡Œæµ‹è¯•äº†ã€‚è¿è¡Œä¸‹æ–¹shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxxxxx</span><br><span class="line">ChatID=xxxxxx</span><br><span class="line"></span><br><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;) #è·å–å½“å‰æ—¶é—´</span><br><span class="line">commitMsg=&quot;</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">main: xxx</span><br><span class="line">blog: xxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">Time: $&#123;currentTime&#125;</span><br><span class="line"></span><br><span class="line">â€”â€”â€”â€”â€”â€”UPDATEâ€”â€”â€”â€”â€”â€”</span><br><span class="line">&quot;</span><br><span class="line">curl -s -X POST https://api.telegram.org/bot$&#123;TG_BOT_TOKEN&#125;/sendMessage -d chat_id=$ChatID -d text=&quot;$commitMsg&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/testmessage.png" alt="image-20250219194830929"></p>
<p>å¦‚æœè¿è¡Œååƒè¿™æ ·æ­£å¸¸è¾“å‡ºäº†ï¼Œé‚£ä¹ˆå°±å®Œæˆä¸€åŠäº†</p>
<p>å¦‚æœè¿è¡Œååå°å¾ˆä¹…æ²¡ååº”ï¼Œé‚£ä¹ˆçœ‹çœ‹æ˜¯ä¸æ˜¯ä»£ç†å‡ºé—®é¢˜äº†</p>
<p>ä¸‹é¢ç»§ç»­ç¼–å†™ä¸€ä¸ªå¾ªç¯ï¼Œç”¨æ¥éå†æ‰€æœ‰æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">path=/home/gubai/www/blog/source/_posts # æ¢æˆä½ çš„æ–‡ç« è·¯å¾„</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªå‡½æ•°ç”¨æ¥è¿½åŠ éœ€è¦pushçš„æ–‡ç« ä¿¡æ¯</span></span><br><span class="line">addUpdate() &#123;</span><br><span class="line">    local commitMsg=&quot;$1&quot;</span><br><span class="line">    local title=&quot;$2&quot;</span><br><span class="line">    local addrlink=&quot;$3&quot;</span><br><span class="line">    local link=&quot;https://blog.gubaiovo.com/posts/$addrlink.html&quot;</span><br><span class="line">    commitMsg+=$(\nprintf &quot;Title: %s\nURL: %s\n&quot; &quot;$title&quot; &quot;$link&quot;)</span><br><span class="line">    commitMsg+=$(printf &quot;\n â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&quot;)</span><br><span class="line">    echo &quot;$commitMsg&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for file in &quot;$path&quot;/*; do</span><br><span class="line">    # è·å–æ–‡ä»¶çš„å‰20è¡Œï¼Œä¹Ÿå°±æ˜¯åŒ…å«Front matterçš„èŒƒå›´ã€‚è¿™é‡Œ20å¯ä»¥æ ¹æ®ä½ çš„Front matterçš„è¡Œæ•°è¿›è¡Œè®¾å®š</span><br><span class="line">    fileContent=$(head -n 20 &quot;$file&quot;)</span><br><span class="line">    # è·å–pushå­—æ®µã€‚å¦‚æœä½ ç”¨äº†å…¶ä»–å­—æ®µä½œä¸ºkeyï¼Œé‚£ä¹ˆå°† &#x27;push:&#x27; æ”¹ä¸ºä½ è®¾å®šçš„å­—æ®µ</span><br><span class="line">    push=$(echo &quot;$fileContent&quot; | grep &#x27;push:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    # trueç”¨æ¥å†³å®šæ¨é€ï¼Œå¦‚æœä½ ç”¨äº†å…¶ä»–çš„valueæ¥å†³å®šæ¨é€ï¼Œæ”¹æˆä½ è®¾å®šçš„value</span><br><span class="line">    if [ &quot;$push&quot; == &quot;true&quot; ]; then</span><br><span class="line">        # æå– title å’Œ abbrlink</span><br><span class="line">        title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        # è¿™é‡Œè°ƒç”¨äº†ä¸Šæ–¹addUpdate()å‡½æ•°ï¼Œç”¨æ¥è¿½åŠ message</span><br><span class="line">        commitMsg=$(addUpdate &quot;$commitMsg&quot; &quot;$title&quot; &quot;$addrlink&quot;)</span><br><span class="line">        # å°†æ¨é€åçš„æ–‡ç« çš„pushå­—æ®µè®¾ä¸ºfalseï¼Œé˜²æ­¢é‡å¤push(å¦‚æœç”¨äº†å…¶ä»–çš„keyå’Œvalueï¼Œè®°å¾—æ›´æ”¹)</span><br><span class="line">        sed -i &#x27;s/push: false/push: false/&#x27; &quot;$file&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç°åœ¨shellè„šæœ¬å¯ä»¥éå†æ‰€æœ‰æ–‡ä»¶ï¼Œè·å¾— <code>push</code> å­—æ®µï¼Œæ ¹æ®å¯¹åº”çš„valueå†³å®šæ˜¯å¦è¿½åŠ åˆ°message</p>
<p>ç›®å‰ä¸ºæ­¢çš„å®Œæ•´shellå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxxxxx</span><br><span class="line">ChatID=xxxxxx</span><br><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;) #è·å–å½“å‰æ—¶é—´</span><br><span class="line">path=/home/gubai/www/blog/source/_posts # æ¢æˆä½ çš„æ–‡ç« è·¯å¾„</span><br><span class="line"></span><br><span class="line">commitMsg=&quot;</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">main: xxx</span><br><span class="line">blog: xxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">Time: $&#123;currentTime&#125;</span><br><span class="line"></span><br><span class="line">â€”â€”â€”â€”â€”â€”UPDATEâ€”â€”â€”â€”â€”â€”</span><br><span class="line">&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸ªå‡½æ•°ç”¨æ¥è¿½åŠ éœ€è¦pushçš„æ–‡ç« ä¿¡æ¯</span></span><br><span class="line">addUpdate() &#123;</span><br><span class="line">    local commitMsg=&quot;$1&quot;</span><br><span class="line">    local title=&quot;$2&quot;</span><br><span class="line">    local addrlink=&quot;$3&quot;</span><br><span class="line">    local link=&quot;https://blog.gubaiovo.com/posts/$addrlink.html&quot;</span><br><span class="line">    commitMsg+=$(\nprintf &quot;Title: %s\nURL: %s\n&quot; &quot;$title&quot; &quot;$link&quot;)</span><br><span class="line">    commitMsg+=$(printf &quot;\n â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&quot;)</span><br><span class="line">    echo &quot;$commitMsg&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for file in &quot;$path&quot;/*; do</span><br><span class="line">    # è·å–æ–‡ä»¶çš„å‰20è¡Œï¼Œä¹Ÿå°±æ˜¯åŒ…å«Front matterçš„èŒƒå›´ã€‚è¿™é‡Œ20å¯ä»¥æ ¹æ®ä½ çš„Front matterçš„è¡Œæ•°è¿›è¡Œè®¾å®š</span><br><span class="line">    fileContent=$(head -n 20 &quot;$file&quot;)</span><br><span class="line">    # è·å–pushå­—æ®µã€‚å¦‚æœä½ ç”¨äº†å…¶ä»–å­—æ®µä½œä¸ºkeyï¼Œé‚£ä¹ˆå°† &#x27;push:&#x27; æ”¹ä¸ºä½ è®¾å®šçš„å­—æ®µ</span><br><span class="line">    push=$(echo &quot;$fileContent&quot; | grep &#x27;push:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    # trueç”¨æ¥å†³å®šæ¨é€ï¼Œå¦‚æœä½ ç”¨äº†å…¶ä»–çš„valueæ¥å†³å®šæ¨é€ï¼Œæ”¹æˆä½ è®¾å®šçš„value</span><br><span class="line">    if [ &quot;$push&quot; == &quot;true&quot; ]; then</span><br><span class="line">        # æå– title å’Œ abbrlink</span><br><span class="line">        title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        # è¿™é‡Œè°ƒç”¨äº†ä¸Šæ–¹addUpdate()å‡½æ•°ï¼Œç”¨æ¥è¿½åŠ message</span><br><span class="line">        commitMsg=$(addUpdate &quot;$commitMsg&quot; &quot;$title&quot; &quot;$addrlink&quot;)</span><br><span class="line">        # å°†æ¨é€åçš„æ–‡ç« çš„pushå­—æ®µè®¾ä¸ºfalseï¼Œé˜²æ­¢é‡å¤push(å¦‚æœç”¨äº†å…¶ä»–çš„keyå’Œvalueï¼Œè®°å¾—æ›´æ”¹)</span><br><span class="line">        sed -i &#x27;s/push: false/push: false/&#x27; &quot;$file&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X POST https://api.telegram.org/bot$&#123;TG_BOT_TOKEN&#125;/sendMessage -d chat_id=$ChatID -d text=&quot;$commitMsg&quot;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ç°åœ¨èƒ½å®ç°è·å–éœ€è¦pushçš„æ–‡ç« å¹¶è¿›è¡Œæ¨é€ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰éœ€è¦pushçš„æ–‡ç« å‘¢ï¼Ÿ</p>
<p>å‡è®¾ç°åœ¨æ‰€æœ‰æ–‡ç« éƒ½æ²¡æœ‰pushå­—æ®µï¼Œæˆ–è€…pushå­—æ®µä¸æ˜¯trueï¼Œé‚£ä¹ˆï¼Œæœ€ç»ˆçš„messageæ˜¯ä¸‹é¢å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">main: xxx</span><br><span class="line">blog: xxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">Time: $&#123;currentTime&#125;</span><br><span class="line"></span><br><span class="line">â€”â€”â€”â€”â€”â€”UPDATEâ€”â€”â€”â€”â€”â€”</span><br></pre></td></tr></table></figure>
<p>botä¼šå°†è¿™ä¸ªæ¿å­æ¨åˆ°é¢‘é“ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯æ²¡æœ‰éœ€è¦pushçš„å°±ä¸pushäº†ã€‚å› æ­¤å¯ä»¥åŠ ä¸€ä¸ªå˜é‡ <code>flag</code> ç”¨æ¥æ ‡è®°æ˜¯å¦éœ€è¦æ¨é€ã€‚<code>flag</code> åˆå§‹åŒ–ä¸º <code>false</code> ï¼Œå¦‚æœåœ¨ä¸Šæ–¹å¾ªç¯éå†ä¸­ <code>if [ &quot;$push&quot; == &quot;true&quot; ]</code> æˆç«‹äº†ï¼Œé‚£ä¹ˆå°±è®© <code>flag</code> ä¸º <code>true</code> ã€‚åœ¨å‘é€è¯·æ±‚æ—¶å…ˆæ£€æµ‹flagå€¼ï¼Œå¦‚æœflagä¸ºtrueï¼Œé‚£ä¹ˆå°±å‘é€è¯·æ±‚</p>
<p>æŒ‰ç…§è¿™ä¸ªæ€è·¯å®Œå–„è„šæœ¬ï¼Œåœ¨æœ€å¼€å¤´æ·»åŠ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=false</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>if [ &quot;$push&quot; == &quot;true&quot; ]</code> åˆ¤æ–­ä¸­æ·»åŠ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if [ &quot;$push&quot; == &quot;true&quot; ]; then</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">è®¾ä¸º<span class="literal">true</span>ç¡®å®šéœ€è¦æ¨é€</span></span><br><span class="line">        flag=true</span><br><span class="line">        title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        commitMsg=$(addUpdate &quot;$commitMsg&quot; &quot;$title&quot; &quot;$addrlink&quot;)</span><br><span class="line">        sed -i &#x27;s/push: false/push: false/&#x27; &quot;$file&quot;</span><br><span class="line">    fi</span><br></pre></td></tr></table></figure>
<p>åœ¨å‘é€è¯·æ±‚å‰æ·»åŠ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [ &quot;$flag&quot; == false ]; then</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>å¦‚æœflagä¸ºfalseï¼Œé‚£ä¹ˆç›´æ¥é€€å‡ºï¼Œä¹Ÿå°±ä¸å‘é€è¯·æ±‚äº†ã€‚</p>
<p>ä¿®æ”¹åçš„shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxxx</span><br><span class="line">ChatID=xxxx</span><br><span class="line">path=/home/gubai/www/blog/source/_posts</span><br><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">flag=false</span><br><span class="line"></span><br><span class="line">commitMsg=&quot;</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">main: xxx</span><br><span class="line">blog: xxx</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">Time: $&#123;currentTime&#125;</span><br><span class="line"></span><br><span class="line">â€”â€”â€”â€”â€”â€”UPDATEâ€”â€”â€”â€”â€”â€”</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">addUpdate() &#123;</span><br><span class="line">    local commitMsg=&quot;$1&quot;</span><br><span class="line">    local title=&quot;$2&quot;</span><br><span class="line">    local addrlink=&quot;$3&quot;</span><br><span class="line">    local link=&quot;https://blog.gubaiovo.com/posts/$addrlink.html&quot;</span><br><span class="line">    commitMsg+=$(\nprintf &quot;Title: %s\nURL: %s\n&quot; &quot;$title&quot; &quot;$link&quot;)</span><br><span class="line">    commitMsg+=$(printf &quot;\n â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&quot;)</span><br><span class="line">    echo &quot;$commitMsg&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for file in &quot;$path&quot;/*; do</span><br><span class="line">    fileContent=$(head -n 20 &quot;$file&quot;)</span><br><span class="line">    push=$(echo &quot;$fileContent&quot; | grep &#x27;push:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    if [ &quot;$push&quot; == &quot;true&quot; ]; then</span><br><span class="line">        flag=true</span><br><span class="line">        title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        commitMsg=$(addUpdate &quot;$commitMsg&quot; &quot;$title&quot; &quot;$addrlink&quot;)</span><br><span class="line">        sed -i &#x27;s/push: false/push: false/&#x27; &quot;$file&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ &quot;$flag&quot; == false ]; then</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line">curl -s -X POST https://api.telegram.org/bot$&#123;TG_BOT_TOKEN&#125;/sendMessage -d chat_id=$ChatID -d text=&quot;$commitMsg&quot;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨åŸºæœ¬å¯ä»¥ä½¿ç”¨äº†ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼štitleä¸­ç‰¹æ®Šç¬¦å·æˆªæ–­å­—ç¬¦ä¸²</p>
<p>è¿™æ˜¯æˆ‘åœ¨æ¨é€æˆ‘çš„Ollama APIè°ƒç”¨æ—¶å‘ç°çš„ï¼Œæ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/test.png" alt="image-20250219202050032"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œluaæ–‡ç« æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯ollamaçš„æ–‡ç« å› ä¸º <code>&amp;</code> è¢«æˆªæ–­äº†ã€‚æˆ‘ä»¬éœ€è¦å¯¹titleè¿›è¡Œç¼–ç </p>
<p>æ·»åŠ ç¼–ç å‡½æ•°</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">URL ç¼–ç å‡½æ•°</span></span><br><span class="line">urlencode() &#123;</span><br><span class="line">    local length=&quot;$&#123;#1&#125;&quot;</span><br><span class="line">    local i=0</span><br><span class="line">    local c</span><br><span class="line">    local encoded=&quot;&quot;</span><br><span class="line">    while [ $i -lt $length ]; do</span><br><span class="line">        c=&quot;$&#123;1:$i:1&#125;&quot;</span><br><span class="line">        # ä½¿ç”¨ iconv æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºasciiï¼Œé¿å…éasciiç æ–‡å­—(å¦‚ä¸­æ–‡)é”™è¯¯ç¼–ç </span><br><span class="line">        if echo &quot;$c&quot; | iconv -f UTF-8 -t ISO-8859-1 &gt;/dev/null 2&gt;&amp;1; then</span><br><span class="line">            case $c in</span><br><span class="line">                [a-zA-Z0-9.~_-]) encoded+=&quot;$c&quot; ;;</span><br><span class="line">                *) encoded+=$(printf &#x27;%%%02X&#x27; &quot;&#x27;$c&quot;) ;;</span><br><span class="line">            esac</span><br><span class="line">        else</span><br><span class="line">            encoded+=&quot;$c&quot;</span><br><span class="line">        fi</span><br><span class="line">        ((i++))</span><br><span class="line">    done</span><br><span class="line">    echo &quot;$encoded&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨å‡½æ•°ï¼Œç¼–ç title</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">        title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        encodedTitle=$(urlencode &quot;$title&quot;)</span><br><span class="line">        commitMsg=$(addUpdate &quot;$commitMsg&quot; &quot;$encodedTitle&quot; &quot;$abbrlink&quot;)     </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><img src="https://image.gubaiovo.com/blog/post_img/dev/Hexo_TG_bot_%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%8E%A8%E9%80%81%E6%96%87%E7%AB%A0%E5%88%B0telegram%E9%A2%91%E9%81%93/final.png" alt="image-20250219202843748"></p>
<p>è¿™æ ·ä¾¿æ­£ç¡®å®ç°äº†æ¨é€åŠŸèƒ½</p>
<h2 id="è‡ªåŠ¨è°ƒç”¨æ¨é€">è‡ªåŠ¨è°ƒç”¨æ¨é€</h2>
<p>ç°åœ¨ç¡®å®å®ç°äº†æ¨é€ï¼Œä½†æ˜¯æ€ä¹ˆæ‰èƒ½åœ¨ <code>hexo d</code> æ—¶è‡ªåŠ¨è°ƒç”¨å‘¢</p>
<p>ä¸¤ç§æ€è·¯ï¼Œä¸€ç§ä¸ºåœ¨shell <code>cd xxx</code>è¿›å…¥blogæ ¹ç›®å½•ï¼Œè°ƒç”¨<code>hexo d</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¸¤è¡Œä½ç½®æ²¡æœ‰å½±å“</span></span><br><span class="line">cd /home/gubai/www/blog</span><br><span class="line">hexo d</span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxx</span><br><span class="line">ChatID=xxxx</span><br><span class="line">path=/home/gubai/www/blog/source/_posts</span><br><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">flag=false</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œä½¿ç”¨hexoæ’ä»¶ <code>hexo-deployer-shell</code> ï¼Œè¿™ä¸ªæ’ä»¶ä¸ºdeployæ·»åŠ æ–°çš„ç±»å‹ <code>shell</code> ï¼Œèƒ½å¤Ÿæ‰§è¡Œshellå‘½ä»¤</p>
<p>github: <a target="_blank" rel="noopener" href="https://github.com/HakurouKen/hexo-deployer-shell">https://github.com/HakurouKen/hexo-deployer-shell</a></p>
<figure class="highlight plaintext"><figcaption><span>i</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-shell --save</span><br></pre></td></tr></table></figure>
<p>å®‰è£…åè¿›å…¥ hexo çš„ <code>_config.yml</code>ï¼Œæ‰¾åˆ° <code>deploy</code>é¡¹ï¼Œåƒè¿™æ ·å¡«å†™</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">xxx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">shell</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">~/www/blog/TG_push.sh</span></span><br></pre></td></tr></table></figure>
<p>hexoåœ¨æ‰§è¡Œ <code>hexo d</code> æ—¶ï¼Œä¼šæŒ‰ç…§ <code>deploy</code> çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ git å’Œ shellï¼Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/one-command-deployment">hexoæ–‡æ¡£</a></p>
<h2 id="ALL-CODE">ALL CODE</h2>
<p>ç¬¬ä¸€ç§æ–¹å¼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxxxx</span><br><span class="line">ChatID=xxxxx</span><br><span class="line">path=xxxx</span><br><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–æ–‡ä»¶å¤¹ä¸­æœ€æ–°çš„æ–‡ä»¶å</span></span><br><span class="line">latestFile=$(ls -t $path | head -n 1)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–æœ€æ–°æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´</span></span><br><span class="line">latestFileTime=$(stat -c %Y &quot;$path/$latestFile&quot;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</span></span><br><span class="line">currentTimeStamp=$(date +%s)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¡ç®—æ—¶é—´å·®ï¼ˆç§’ï¼‰</span></span><br><span class="line">timeDiff=$((currentTimeStamp - latestFileTime))</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæ—¶é—´å·®è¶…è¿‡1800ç§’ï¼ˆ30åˆ†é’Ÿï¼‰ï¼Œåˆ™ä¸è¿›è¡Œæ¨é€</span></span><br><span class="line">if [ $timeDiff -gt 1800 ]; then</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–æ–‡ä»¶çš„å‰20è¡Œ</span></span><br><span class="line">fileContent=$(head -n 20 &quot;$path/$latestFile&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">URL ç¼–ç å‡½æ•°</span></span><br><span class="line">urlencode() &#123;</span><br><span class="line">    local length=&quot;$&#123;#1&#125;&quot;</span><br><span class="line">    local i=0</span><br><span class="line">    local c</span><br><span class="line">    local encoded=&quot;&quot;</span><br><span class="line">    while [ $i -lt $length ]; do</span><br><span class="line">        c=&quot;$&#123;1:$i:1&#125;&quot;</span><br><span class="line">        # ä½¿ç”¨ iconv æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºä¸­æ–‡</span><br><span class="line">        if echo &quot;$c&quot; | iconv -f UTF-8 -t ISO-8859-1 &gt;/dev/null 2&gt;&amp;1; then</span><br><span class="line">            case $c in</span><br><span class="line">                [a-zA-Z0-9.~_-]) encoded+=&quot;$c&quot; ;;</span><br><span class="line">                *) encoded+=$(printf &#x27;%%%02X&#x27; &quot;&#x27;$c&quot;) ;;</span><br><span class="line">            esac</span><br><span class="line">        else</span><br><span class="line">            encoded+=&quot;$c&quot;</span><br><span class="line">        fi</span><br><span class="line">        ((i++))</span><br><span class="line">    done</span><br><span class="line">    echo &quot;$encoded&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æå– title å’Œ abbrlink</span></span><br><span class="line">title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">encodedTitle=$(urlencode &quot;$title&quot;)</span><br><span class="line"></span><br><span class="line">commitMsg=&quot;</span><br><span class="line">æ¨é€æ—¶é—´ï¼š$currentTime</span><br><span class="line"></span><br><span class="line">æ›´æ–°ï¼š$encodedTitle</span><br><span class="line"></span><br><span class="line">æ–‡ç« é“¾æ¥ï¼šhttps://blog.gubaiovo.com/posts/$addrlink.html</span><br><span class="line">&quot;</span><br><span class="line">curl -s -X POST https://api.telegram.org/bot$&#123;TG_BOT_TOKEN&#125;/sendMessage -d chat_id=$ChatID -d text=&quot;$commitMsg&quot;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹å¼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">TG_BOT_TOKEN=xxxx</span><br><span class="line">ChatID=xxxxx</span><br><span class="line">path=xxxxx</span><br><span class="line">currentTime=$(date +&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">flag=false</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">URL ç¼–ç å‡½æ•°</span></span><br><span class="line">urlencode() &#123;</span><br><span class="line">    local length=&quot;$&#123;#1&#125;&quot;</span><br><span class="line">    local i=0</span><br><span class="line">    local c</span><br><span class="line">    local encoded=&quot;&quot;</span><br><span class="line">    while [ $i -lt $length ]; do</span><br><span class="line">        c=&quot;$&#123;1:$i:1&#125;&quot;</span><br><span class="line">        # ä½¿ç”¨ iconv æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºä¸­æ–‡</span><br><span class="line">        if echo &quot;$c&quot; | iconv -f UTF-8 -t ISO-8859-1 &gt;/dev/null 2&gt;&amp;1; then</span><br><span class="line">            case $c in</span><br><span class="line">                [a-zA-Z0-9.~_-]) encoded+=&quot;$c&quot; ;;</span><br><span class="line">                *) encoded+=$(printf &#x27;%%%02X&#x27; &quot;&#x27;$c&quot;) ;;</span><br><span class="line">            esac</span><br><span class="line">        else</span><br><span class="line">            encoded+=&quot;$c&quot;</span><br><span class="line">        fi</span><br><span class="line">        ((i++))</span><br><span class="line">    done</span><br><span class="line">    echo &quot;$encoded&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addUpdate() &#123;</span><br><span class="line">    local commitMsg=&quot;$1&quot;</span><br><span class="line">    local title=&quot;$2&quot;</span><br><span class="line">    local addrlink=&quot;$3&quot;</span><br><span class="line">    local link=&quot;https://blog.gubaiovo.com/posts/$addrlink.html&quot;</span><br><span class="line">    commitMsg+=$(printf &quot;\nTitle: %s\nURL: %s\n&quot; &quot;$title&quot; &quot;$link&quot;)</span><br><span class="line">    commitMsg+=$(printf &quot;\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&quot;)</span><br><span class="line">    echo &quot;$commitMsg&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">commitMsg=&quot;</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">main: https://www.gubaiovo.com</span><br><span class="line">blog: https://blog.gubaiovo.com</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line">Time: $&#123;currentTime&#125;</span><br><span class="line"></span><br><span class="line">â€”â€”â€”â€”â€”â€”UPDATEâ€”â€”â€”â€”â€”â€”</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">for file in &quot;$path&quot;/*; do</span><br><span class="line">    # è·å–æ–‡ä»¶çš„å‰20è¡Œ</span><br><span class="line">    fileContent=$(head -n 20 &quot;$file&quot;)</span><br><span class="line">    push=$(echo &quot;$fileContent&quot; | grep &#x27;push:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    if [ &quot;$push&quot; == &quot;true&quot; ]; then</span><br><span class="line">        flag=true</span><br><span class="line">        # æå– title å’Œ abbrlink</span><br><span class="line">        title=$(echo &quot;$fileContent&quot; | grep &#x27;title:&#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        addrlink=$(echo &quot;$fileContent&quot; | grep &#x27;abbrlink: &#x27; | awk -F&#x27;: &#x27; &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">        encodedTitle=$(urlencode &quot;$title&quot;)</span><br><span class="line">        commitMsg=$(addUpdate &quot;$commitMsg&quot; &quot;$encodedTitle&quot; &quot;$addrlink&quot;)</span><br><span class="line">        sed -i &#x27;s/push: false/push: false/&#x27; &quot;$file&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ &quot;$flag&quot; == false ]; then</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line">curl -s -X POST https://api.telegram.org/bot$&#123;TG_BOT_TOKEN&#125;/sendMessage -d chat_id=$ChatID -d text=&quot;$commitMsg&quot;</span><br></pre></td></tr></table></figure>
<p>é¡¾ç™½çš„tgé¢‘é“ <a target="_blank" rel="noopener" href="https://t.me/gubaiblog">https://t.me/gubaiblog</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/about/">å…³äº</a></li>
        
          <li><a href="/archives/">æ–‡ç« </a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/gubaiovo">é¡¹ç›®</a></li>
        
          <li><a href="/search/">æœç´¢</a></li>
        
          <li><a href="/categories/">åˆ†ç±»</a></li>
        
          <li><a href="/links/">é“¾æ¥</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B3%E8%AF%B7tg-bot"><span class="toc-number">1.1.</span> <span class="toc-text">ç”³è¯·tg bot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99shell"><span class="toc-number">1.2.</span> <span class="toc-text">ç¼–å†™shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%B0%83%E7%94%A8%E6%8E%A8%E9%80%81"><span class="toc-number">1.3.</span> <span class="toc-text">è‡ªåŠ¨è°ƒç”¨æ¨é€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ALL-CODE"><span class="toc-number">1.4.</span> <span class="toc-text">ALL CODE</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.gubaiovo.com/posts/a6f3e185.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.gubaiovo.com/posts/a6f3e185.html&text=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.gubaiovo.com/posts/a6f3e185.html&is_video=false&description=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“&body=Check out this article: https://www.gubaiovo.com/posts/a6f3e185.html"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.gubaiovo.com/posts/a6f3e185.html&title=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.gubaiovo.com/posts/a6f3e185.html&name=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.gubaiovo.com/posts/a6f3e185.html&t=Hexo + TG bot å®ç°è‡ªåŠ¨æ¨é€æ–‡ç« åˆ°telegramé¢‘é“"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2026
    gubai
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">æ–‡ç« </a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/gubaiovo">é¡¹ç›®</a></li><!--
     --><!--
       --><li><a href="/search/">æœç´¢</a></li><!--
     --><!--
       --><li><a href="/categories/">åˆ†ç±»</a></li><!--
     --><!--
       --><li><a href="/links/">é“¾æ¥</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
